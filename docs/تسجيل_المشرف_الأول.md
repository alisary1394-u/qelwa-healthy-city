# تسجيل المشرف الأول

## ما الذي تم إضافته؟

- **دالة في الخلفية (هيكل Base44):** مجلد `base44/functions/createFirstGovernor/` فيه `function.jsonc` و`index.ts` — تنشئ عضو فريق واحد بدور "المشرف العام" فقط عندما لا يوجد أي أعضاء.
- **نسخة قديمة (جذر المشروع):** `functions/createFirstGovernor.ts` — يمكن تركها أو حذفها؛ النشر يعتمد على `base44/functions/`.
- **في الواجهة:** في صفحة الرئيسية (تسجيل الدخول) رابط **"أول مرة؟ سجّل نفسك كمشرف"** يفتح نموذج التسجيل.

## نشر الدالة (افعل ذلك أنت)

1. **من مجلد المشروع** شغّل أحد الخيارين:
   - **مزدوج النقر:** افتح الملف `run-base44-deploy.bat` من مستكشف الملفات (يعمل من مجلد المشروع تلقائياً).
   - **أو من الطرفية:** افتح cmd في مجلد المشروع ثم نفّذ:
     ```bash
     npx base44@latest functions deploy --yes
     ```
2. إن ظهر أن المشروع غير مربوط بتطبيق Base44، نفّذ أولاً:
   ```bash
   npx base44@latest link
   ```
   ثم اختر التطبيق المناسب (نفس التطبيق الذي في `.env.local`: `VITE_BASE44_APP_ID` و `VITE_BASE44_APP_BASE_URL`).
3. بعد النشر بنجاح، جرّب من التطبيق: الرئيسية → "أول مرة؟ سجّل نفسك كمشرف" → املأ النموذج واضغط "تسجيلني كمشرف".

## لماذا "لم تنجح"؟

غالباً أحد الأسباب التالية:

### 1. الدالة غير منشورة على Base44

الدالة يجب أن تُنشر إلى تطبيقك في Base44.

- من لوحة Base44: افتح تطبيقك → **Functions** (أو الدوال) → تأكد وجود الدالة **createFirstGovernor** وأنها منشورة.
- أو من الطرفية في مجلد المشروع (إن كان عندك أوامر النشر):
  ```bash
  npx base44 deploy
  ```
  أو حسب ما توضحه وثائق Base44 لنشر الدوال.

### 2. الدالة تحتاج صلاحية "عامة" (بدون تسجيل دخول)

أول مشرف يسجّل نفسه **قبل** وجود أي مستخدم مسجّل، لذلك استدعاء الدالة يكون **بدون توكن**.

- من لوحة Base44: ادخل إلى إعدادات الدالة **createFirstGovernor** (أو إعدادات الدوال) واسمح بـ **استدعاء الدالة بدون تسجيل دخول** (أو Public / Allow unauthenticated) حسب ما يوفره المنتج.

### 3. خطأ 404 أو الاتصال بـ Base44

- تأكد أن `.env.local` يحتوي على القيم الصحيحة من لوحة Base44:
  - `VITE_BASE44_APP_ID=معرف_التطبيق`
  - `VITE_BASE44_APP_BASE_URL=https://....base44.app`
- أعد تشغيل التطبيق بعد تعديل `.env.local`.

### 4. رسالة الخطأ في الواجهة

تم تحسين رسائل الخطأ في التطبيق. عند فشل "تسجيلني كمشرف" ستظهر رسالة أوضح (مثلاً: الدالة غير منشورة، أو الطلب مرفوض). استخدمها لتحديد السبب.

## بعد النجاح

1. بعد تسجيلك كمشرف من النموذج، استخدم **نفس رقم الهوية وكلمة المرور** في نموذج تسجيل الدخول.
2. سيُرسل رمز تحقق إلى بريدك — أدخله ثم أكمل الدخول.
3. تأكد أن **نفس البريد الإلكتروني** مضاف كمستخدم في تطبيقك من لوحة Base44 (قسم المستخدمين/الدعوات) حتى يعمل تسجيل الدخول عبر Base44 بعد التحقق.
